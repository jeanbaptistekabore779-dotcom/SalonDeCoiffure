{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tableau de bord - Salon</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
:root {
  --bg: #17222d;
  --sidebar-bg: #35080c;
  --card-bg: rgba(255, 255, 255, 0.05);
  --text: #e6eef8;
  --muted: #94a3b8;
  --accent: #6dd5ed;
  --accent2: #2193b0;
  --radius: 18px;
  --gap: 20px;
}
* { box-sizing: border-box; font-family: 'Inter', sans-serif; }
html, body { margin: 0; padding: 0; height: 100%; background: var(--bg); color: var(--text); }
a { text-decoration: none; color: inherit; }
.app { display: flex; min-height: 100vh; overflow: hidden; }
.sidebar { width: 260px; background: var(--sidebar-bg); display: flex; flex-direction: column; padding: 30px 20px; gap: var(--gap); box-shadow: 2px 0 10px rgba(0,0,0,0.5); overflow-y: auto; }
.brand { font-weight: 700; font-size: 22px; color: var(--accent); margin-bottom: 20px; }
.profile { display: flex; gap: 12px; align-items: center; margin-bottom: 20px; }
.avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--accent2)); display: flex; align-items: center; justify-content: center; font-weight: 700; color: #fff; font-size: 16px; }
.side-nav { display: flex; flex-direction: column; gap: 8px; }
.side-nav a { display: flex; align-items: center; padding: 12px 16px; border-radius: var(--radius); transition: all 0.2s ease; font-weight: 500; }
.side-nav a:hover { background: rgba(255,255,255,0.08); transform: translateX(6px); color: var(--accent); }
.side-footer { margin-top: auto; font-size: 13px; color: var(--muted); text-align: center; }
.main { flex: 1; padding: 30px; display: flex; flex-direction: column; gap: var(--gap); background: linear-gradient(180deg, rgba(21, 35, 55, 0.95), var(--bg)); overflow-y: auto; }
.topbar { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
.search { flex: 1; max-width: 500px; background: rgba(255,255,255,0.05); border-radius: var(--radius); padding: 10px 15px; display: flex; align-items: center; gap: 8px; }
.search input { flex: 1; border: 0; background: transparent; color: var(--text); outline: none; }
.top-actions { display: flex; gap: 12px; flex-wrap: wrap; }
.btn { background: linear-gradient(90deg, var(--accent), var(--accent2)); color: #fff; padding: 10px 18px; border-radius: var(--radius); font-weight: 600; border: 0; cursor: pointer; transition: all 0.2s ease; }
.btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(117, 67, 67, 0.3); }
.grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: var(--gap); }
.col-3 { grid-column: span 3; } .col-4 { grid-column: span 4; } .col-6 { grid-column: span 6; } .col-8 { grid-column: span 8; } .col-9 { grid-column: span 9; }
.card { background: var(--card-bg); padding: 20px; border-radius: var(--radius); box-shadow: 0 10px 25px rgba(255, 255, 255, 0.3); transition: all 0.3s ease; }
.card:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(126, 66, 66, 0.4); }
.card h3, .card h4 { margin: 0 0 10px 0; font-size: 16px; color: var(--accent); }
.stat { font-size: 32px; font-weight: 700; }
.muted { color: var(--muted); font-size: 13px; }
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
thead th { text-align: left; padding: 12px 14px; color: var(--muted); font-size: 13px; border-bottom: 1px solid rgba(255,255,255,0.1); }
tbody td { padding: 12px 14px; border-bottom: 1px dashed rgba(255,255,255,0.07); }
tbody tr:hover { background: rgba(255,255,255,0.05); }
.list-group-item { background: transparent; border: none; padding: 10px 15px; border-radius: var(--radius); transition: all 0.2s ease; }
.list-group-item:hover { background: rgba(255,255,255,0.08); }
@media (max-width:980px) { .sidebar { display: none; } .grid { grid-template-columns: repeat(6, 1fr); } .col-3, .col-4, .col-6 { grid-column: span 6; } }
@media (max-width:600px) { .topbar { flex-direction: column; align-items: stretch; } .search { max-width: 100%; } }
  </style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="brand">Tableau de bord</div>
    <div class="profile">
      <div class="avatar">JBK</div>
      <div>
        <div style="font-weight:750">groupe 4</div>
        <div class="muted" style="font-size:13px">Administrateur</div>
      </div>
    </div>
    <nav class="side-nav">
      <a href="/"><i class="bi bi-house-door-fill me-2"></i> Accueil</a>
      <a href="{% url 'liste_clients' %}"><i class="bi bi-person-fill me-2"></i> Clients</a>
      <a href="{% url 'liste_rdv' %}"><i class="bi bi-calendar-event-fill me-2"></i> Rendez-vous</a>
      <a href="{% url 'liste_produits' %}"><i class="bi bi-box-seam me-2"></i> Produits</a>
      <a href="{% url 'liste_paiements' %}"><i class="bi bi-credit-card-fill me-2"></i> Paiements</a>
      <a href="{% url 'parametre' %}"><i class="bi bi-gear-fill me-2"></i> Param√®tres</a>
    </nav>
    <div class="side-footer">¬© {{ now.year }} Salon ‚Äî G4</div>
  </aside>

  <main class="main">
    <div class="topbar">
      <div class="search">
        <i class="bi bi-search me-2"></i>
        <input placeholder="Rechercher clients, rendez-vous, produits...">
      </div>
      <div class="top-actions">
        <button class="btn">Nouveau RDV</button>
        <div class="flex">
          <div class="muted">Salut, Admin</div>
        </div>
      </div>
    </div>

    <!-- Stats -->
    <section class="grid mt-3">
      <div class="col-3 card">
        <h3>Clients inscrits</h3>
        <div class="stat">{{ clients }}</div>
        <div class="muted">Depuis le d√©but</div>
      </div>
      <div class="col-3 card">
        <h3>Rendez-vous aujourd'hui</h3>
        <div class="stat">{{ rdv }}</div>
        <div class="muted">Confirm√©s / En attente</div>
      </div>
      <div class="col-3 card">
        <h3>Produits en stock</h3>
        <div class="stat">{{ produits }}</div>
        <div class="muted">Produits disponibles</div>
      </div>
      <div class="col-3 card">
        <h3>Revenu (mois)</h3>
        <div class="stat">{{ paiements|intcomma }} FCFA</div>
        <div class="muted">Montant en FCFA</div>
      </div>
    </section>

    <!-- Produits r√©cents -->
    <section class="card mt-3">
      <h3>Produits r√©cents</h3>
      <div class="table-wrap mt-2">
        <table>
          <thead>
            <tr>
              <th>Produit</th>
              <th>Prix</th>
              <th>Stock</th>
              <th>Date d'ajout</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for produit in produits_recents %}
            <tr>
              <td>{{ produit.nom }}</td>
              <td>{{ produit.prix_unitaire|intcomma }} FCFA</td>
              <td>{{ produit.stock }}</td>
              <td>{{ produit.date_ajout|date:"d/m/Y" }}</td>
              <td><a href="{% url 'liste_produits' %}">Voir</a></td>
            </tr>
            {% empty %}
            <tr><td colspan="5" class="muted">Aucun produit trouv√©.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>

   <!-- Prochains rendez-vous -->
<div class="col-8 card">
    <h3>Prochains rendez-vous</h3>
    <div class="muted mt-1">Liste des 10 prochains RDV</div>
    <ul class="mt-2" style="padding-left:14px;color:var(--muted)">
        {% for rdv in rdv_prochains %}
            <li>{{ rdv.client.nom }} - {{ rdv.service.libelle }} le {{ rdv.date_rdv|date:"d/m/Y" }} √† {{ rdv.heure }}</li>
        {% empty %}
            <li class="muted">Aucun rendez-vous pr√©vu</li>
        {% endfor %}
    </ul>
</div>
<div class="col-4 card p-3">
    <h4>üîî Notifications r√©centes ({{ notifs_non_lues }} non lues)</h4>
    {% if notifications %}
        <ul class="list-group mt-2">
            {% for notif in notifications|slice:":5" %}
                <li class="list-group-item d-flex justify-content-between align-items-center 
                           {% if not notif.vu %}fw-bold{% endif %}">
                    <a href="{% url 'lire_notification' notif.id %}" class="text-decoration-none text-dark">
                        {{ notif.message }}
                    </a>
                    <small class="text-muted">{{ notif.date|date:"d-m-Y H:i" }}</small>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="mt-2">Aucune notification pour le moment.</p>
    {% endif %}
</div>

    </section>
  </main>
</div>
</body>
</html>
